(this.webpackJsonpcypherverse=this.webpackJsonpcypherverse||[]).push([[12],{474:function(t,e,i){"use strict";var n=i(8),a=i(1),s=i.n(a),r=i(475),o=s.a.forwardRef((function(t,e){var i=Object(a.useRef)(null),o=Object(a.useRef)([]),h=Object(a.useRef)(),l=Object(a.useState)([]),c=Object(n.a)(l,2),g=c[0],u=c[1];Object(a.useImperativeHandle)(e,(function(){return{pageFlip:function(){return h.current}}}));var d=Object(a.useCallback)((function(){h.current&&h.current.clear()}),[]),p=Object(a.useCallback)((function(){var t=h.current;t&&(t.off("flip"),t.off("changeOrientation"),t.off("changeState"),t.off("init"),t.off("update"))}),[]);return Object(a.useEffect)((function(){if(o.current=[],t.children){var e=s.a.Children.map(t.children,(function(t){return s.a.cloneElement(t,{ref:function(t){t&&o.current.push(t)}})}));t.renderOnlyPageLengthChange&&g.length===e.length||(e.length<g.length&&d(),u(e))}}),[t.children]),Object(a.useEffect)((function(){g.length>0&&o.current.length>0&&(p(),i.current&&!h.current&&(h.current=new r.PageFlip(i.current,t)),h.current.getFlipController()?h.current.updateFromHtml(o.current):h.current.loadFromHTML(o.current),function(){var e=h.current;e&&(t.onFlip&&e.on("flip",(function(e){return t.onFlip(e)})),t.onChangeOrientation&&e.on("changeOrientation",(function(e){return t.onChangeOrientation(e)})),t.onChangeState&&e.on("changeState",(function(e){return t.onChangeState(e)})),t.onInit&&e.on("init",(function(e){return t.onInit(e)})),t.onUpdate&&e.on("update",(function(e){return t.onUpdate(e)})))}())}),[g]),s.a.createElement("div",{ref:i,className:t.className,style:t.style},g)})),h=s.a.memo(o);e.a=h},475:function(t,e,i){var n=i(131),a=i(76),s=i(86),r=i(52),o=i(53),h=i(51),l=i(55);!function(t){"use strict";var e=function(){function t(e,i){h(this,t),this.state={angle:0,area:[],position:{x:0,y:0},hardAngle:0,hardDrawingAngle:0},this.createdDensity=i,this.nowDrawingDensity=this.createdDensity,this.render=e}return l(t,[{key:"setDensity",value:function(t){this.createdDensity=t,this.nowDrawingDensity=t}},{key:"setDrawingDensity",value:function(t){this.nowDrawingDensity=t}},{key:"setPosition",value:function(t){this.state.position=t}},{key:"setAngle",value:function(t){this.state.angle=t}},{key:"setArea",value:function(t){this.state.area=t}},{key:"setHardDrawingAngle",value:function(t){this.state.hardDrawingAngle=t}},{key:"setHardAngle",value:function(t){this.state.hardAngle=t,this.state.hardDrawingAngle=t}},{key:"setOrientation",value:function(t){this.orientation=t}},{key:"getDrawingDensity",value:function(){return this.nowDrawingDensity}},{key:"getDensity",value:function(){return this.createdDensity}},{key:"getHardAngle",value:function(){return this.state.hardAngle}}]),t}(),i=function(t){r(i,t);var e=o(i);function i(t,n,a){var s;return h(this,i),(s=e.call(this,t,a)).image=null,s.isLoad=!1,s.loadingAngle=0,s.image=new Image,s.image.src=n,s}return l(i,[{key:"draw",value:function(t){var e=this.render.getContext(),i=this.render.convertToGlobal(this.state.position),n=this.render.getRect().pageWidth,a=this.render.getRect().height;e.save(),e.translate(i.x,i.y),e.beginPath();var r,o=s(this.state.area);try{for(o.s();!(r=o.n()).done;){var h=r.value;null!==h&&(h=this.render.convertToGlobal(h),e.lineTo(h.x-i.x,h.y-i.y))}}catch(l){o.e(l)}finally{o.f()}e.rotate(this.state.angle),e.clip(),this.isLoad?e.drawImage(this.image,0,0,n,a):this.drawLoader(e,{x:0,y:0},n,a),e.restore()}},{key:"simpleDraw",value:function(t){var e=this.render.getRect(),i=this.render.getContext(),n=e.pageWidth,a=e.height,s=1===t?e.left+e.pageWidth:e.left,r=e.top;this.isLoad?i.drawImage(this.image,s,r,n,a):this.drawLoader(i,{x:s,y:r},n,a)}},{key:"drawLoader",value:function(t,e,i,n){t.beginPath(),t.strokeStyle="rgb(200, 200, 200)",t.fillStyle="rgb(255, 255, 255)",t.lineWidth=1,t.rect(e.x+1,e.y+1,i-1,n-1),t.stroke(),t.fill();var a={x:e.x+i/2,y:e.y+n/2};t.beginPath(),t.lineWidth=10,t.arc(a.x,a.y,20,this.loadingAngle,3*Math.PI/2+this.loadingAngle),t.stroke(),t.closePath(),this.loadingAngle+=.07,this.loadingAngle>=2*Math.PI&&(this.loadingAngle=0)}},{key:"load",value:function(){var t=this;this.isLoad||(this.image.onload=function(){t.isLoad=!0})}},{key:"newTemporaryCopy",value:function(){return this}},{key:"getTemporaryCopy",value:function(){return this}},{key:"hideTemporaryCopy",value:function(){}}]),i}(e),c=function(){function t(e,i){h(this,t),this.pages=[],this.currentPageIndex=0,this.currentSpreadIndex=0,this.landscapeSpread=[],this.portraitSpread=[],this.render=i,this.app=e,this.currentPageIndex=0,this.isShowCover=this.app.getSettings().showCover}return l(t,[{key:"destroy",value:function(){this.pages=[]}},{key:"createSpread",value:function(){this.landscapeSpread=[],this.portraitSpread=[];for(var t=0;t<this.pages.length;t++)this.portraitSpread.push([t]);var e=0;this.isShowCover&&(this.pages[0].setDensity("hard"),this.landscapeSpread.push([e]),e++);for(var i=e;i<this.pages.length;i+=2)i<this.pages.length-1?this.landscapeSpread.push([i,i+1]):(this.landscapeSpread.push([i]),this.pages[i].setDensity("hard"))}},{key:"getSpread",value:function(){return"landscape"===this.render.getOrientation()?this.landscapeSpread:this.portraitSpread}},{key:"getSpreadIndexByPage",value:function(t){for(var e=this.getSpread(),i=0;i<e.length;i++)if(t===e[i][0]||t===e[i][1])return i;return null}},{key:"getPageCount",value:function(){return this.pages.length}},{key:"getPages",value:function(){return this.pages}},{key:"getPage",value:function(t){if(t>=0&&t<this.pages.length)return this.pages[t];throw new Error("Invalid page number")}},{key:"nextBy",value:function(t){var e=this.pages.indexOf(t);return e<this.pages.length-1?this.pages[e+1]:null}},{key:"prevBy",value:function(t){var e=this.pages.indexOf(t);return e>0?this.pages[e-1]:null}},{key:"getFlippingPage",value:function(t){var e=this.currentSpreadIndex;if("portrait"===this.render.getOrientation())return 0===t?this.pages[e].newTemporaryCopy():this.pages[e-1];var i=0===t?this.getSpread()[e+1]:this.getSpread()[e-1];return 1===i.length||0===t?this.pages[i[0]]:this.pages[i[1]]}},{key:"getBottomPage",value:function(t){var e=this.currentSpreadIndex;if("portrait"===this.render.getOrientation())return 0===t?this.pages[e+1]:this.pages[e-1];var i=0===t?this.getSpread()[e+1]:this.getSpread()[e-1];return 1===i.length?this.pages[i[0]]:0===t?this.pages[i[1]]:this.pages[i[0]]}},{key:"showNext",value:function(){this.currentSpreadIndex<this.getSpread().length&&(this.currentSpreadIndex++,this.showSpread())}},{key:"showPrev",value:function(){this.currentSpreadIndex>0&&(this.currentSpreadIndex--,this.showSpread())}},{key:"getCurrentPageIndex",value:function(){return this.currentPageIndex}},{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===t&&(t=this.currentPageIndex),!(t<0||t>=this.pages.length)){var e=this.getSpreadIndexByPage(t);null!==e&&(this.currentSpreadIndex=e,this.showSpread())}}},{key:"getCurrentSpreadIndex",value:function(){return this.currentSpreadIndex}},{key:"setCurrentSpreadIndex",value:function(t){if(!(t>=0&&t<this.getSpread().length))throw new Error("Invalid page");this.currentSpreadIndex=t}},{key:"showSpread",value:function(){var t=this.getSpread()[this.currentSpreadIndex];2===t.length?(this.render.setLeftPage(this.pages[t[0]]),this.render.setRightPage(this.pages[t[1]])):"landscape"===this.render.getOrientation()&&t[0]===this.pages.length-1?(this.render.setLeftPage(this.pages[t[0]]),this.render.setRightPage(null)):(this.render.setLeftPage(null),this.render.setRightPage(this.pages[t[0]])),this.currentPageIndex=t[0],this.app.updatePageIndex(this.currentPageIndex)}}]),t}(),g=function(t){r(n,t);var e=o(n);function n(t,i,a){var s;return h(this,n),(s=e.call(this,t,i)).imagesHref=a,s}return l(n,[{key:"load",value:function(){var t,e=s(this.imagesHref);try{for(e.s();!(t=e.n()).done;){var n=t.value,a=new i(this.render,n,"soft");a.load(),this.pages.push(a)}}catch(r){e.e(r)}finally{e.f()}this.createSpread()}}]),n}(c),u=function(){function t(){h(this,t)}return l(t,null,[{key:"GetDistanceBetweenTwoPoint",value:function(t,e){return null===t||null===e?1/0:Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}},{key:"GetSegmentLength",value:function(e){return t.GetDistanceBetweenTwoPoint(e[0],e[1])}},{key:"GetAngleBetweenTwoLine",value:function(t,e){var i=t[0].y-t[1].y,n=e[0].y-e[1].y,a=t[1].x-t[0].x,s=e[1].x-e[0].x;return Math.acos((i*n+a*s)/(Math.sqrt(i*i+a*a)*Math.sqrt(n*n+s*s)))}},{key:"PointInRect",value:function(t,e){return null===e?null:e.x>=t.left&&e.x<=t.width+t.left&&e.y>=t.top&&e.y<=t.top+t.height?e:null}},{key:"GetRotatedPoint",value:function(t,e,i){return{x:t.x*Math.cos(i)+t.y*Math.sin(i)+e.x,y:t.y*Math.cos(i)-t.x*Math.sin(i)+e.y}}},{key:"LimitPointToCircle",value:function(e,i,n){if(t.GetDistanceBetweenTwoPoint(e,n)<=i)return n;var a=e.x,s=e.y,r=n.x,o=n.y,h=Math.sqrt(Math.pow(i,2)*Math.pow(a-r,2)/(Math.pow(a-r,2)+Math.pow(s-o,2)))+a;n.x<0&&(h*=-1);var l=(h-a)*(s-o)/(a-r)+s;return a-r+s===0&&(l=i),{x:h,y:l}}},{key:"GetIntersectBetweenTwoSegment",value:function(e,i,n){return t.PointInRect(e,t.GetIntersectBeetwenTwoLine(i,n))}},{key:"GetIntersectBeetwenTwoLine",value:function(t,e){var i=t[0].y-t[1].y,n=e[0].y-e[1].y,a=t[1].x-t[0].x,s=e[1].x-e[0].x,r=t[0].x*t[1].y-t[1].x*t[0].y,o=e[0].x*e[1].y-e[1].x*e[0].y,h=i*o-n*r,l=a*o-s*r,c=-(r*s-o*a)/(i*s-n*a),g=-(i*o-n*r)/(i*s-n*a);if(isFinite(c)&&isFinite(g))return{x:c,y:g};if(Math.abs(h-l)<.1)throw new Error("Segment included");return null}},{key:"GetCordsFromTwoPoint",value:function(t,e){var i=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y),a=Math.max(i,n),s=[t];function r(t,e,i,n,a){return e>t?t+a*(i/n):e<t?t-a*(i/n):t}for(var o=1;o<=a;o+=1)s.push({x:r(t.x,e.x,i,a,o),y:r(t.y,e.y,n,a,o)});return s}}]),t}(),d=function(t){r(i,t);var e=o(i);function i(t,n,a){var s;return h(this,i),(s=e.call(this,t,a)).copiedElement=null,s.temporaryCopy=null,s.isLoad=!1,s.element=n,s.element.classList.add("stf__item"),s.element.classList.add("--"+a),s}return l(i,[{key:"newTemporaryCopy",value:function(){return"hard"===this.nowDrawingDensity?this:(null===this.temporaryCopy&&(this.copiedElement=this.element.cloneNode(!0),this.element.parentElement.appendChild(this.copiedElement),this.temporaryCopy=new i(this.render,this.copiedElement,this.nowDrawingDensity)),this.getTemporaryCopy())}},{key:"getTemporaryCopy",value:function(){return this.temporaryCopy}},{key:"hideTemporaryCopy",value:function(){null!==this.temporaryCopy&&(this.copiedElement.remove(),this.copiedElement=null,this.temporaryCopy=null)}},{key:"draw",value:function(t){var e=t||this.nowDrawingDensity,i=this.render.convertToGlobal(this.state.position),n=this.render.getRect().pageWidth,a=this.render.getRect().height;this.element.classList.remove("--simple");var s="\n            display: block;\n            z-index: ".concat(this.element.style.zIndex,";\n            left: 0;\n            top: 0;\n            width: ").concat(n,"px;\n            height: ").concat(a,"px;\n        ");"hard"===e?this.drawHard(s):this.drawSoft(i,s)}},{key:"drawHard",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.render.getRect().left+this.render.getRect().width/2,i=this.state.hardDrawingAngle,n=t+"\n                backface-visibility: hidden;\n                -webkit-backface-visibility: hidden;\n                clip-path: none;\n                -webkit-clip-path: none;\n            "+(0===this.orientation?"transform-origin: ".concat(this.render.getRect().pageWidth,"px 0; \n                   transform: translate3d(0, 0, 0) rotateY(").concat(i,"deg);"):"transform-origin: 0 0; \n                   transform: translate3d(".concat(e,"px, 0, 0) rotateY(").concat(i,"deg);"));this.element.style.cssText=n}},{key:"drawSoft",value:function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="polygon( ",a=s(this.state.area);try{for(a.s();!(e=a.n()).done;){var r=e.value;if(null!==r){var o=1===this.render.getDirection()?{x:-r.x+this.state.position.x,y:r.y-this.state.position.y}:{x:r.x-this.state.position.x,y:r.y-this.state.position.y};n+=(o=u.GetRotatedPoint(o,{x:0,y:0},this.state.angle)).x+"px "+o.y+"px, "}}}catch(l){a.e(l)}finally{a.f()}n=n.slice(0,-2);var h=i+"transform-origin: 0 0; clip-path: ".concat(n+=")","; -webkit-clip-path: ").concat(n,";")+(this.render.isSafari()&&0===this.state.angle?"transform: translate(".concat(t.x,"px, ").concat(t.y,"px);"):"transform: translate3d(".concat(t.x,"px, ").concat(t.y,"px, 0) rotate(").concat(this.state.angle,"rad);"));this.element.style.cssText=h}},{key:"simpleDraw",value:function(t){var e=this.render.getRect(),i=e.pageWidth,n=e.height,a=1===t?e.left+e.pageWidth:e.left,s=e.top;this.element.classList.add("--simple"),this.element.style.cssText="\n            position: absolute; \n            display: block; \n            height: ".concat(n,"px; \n            left: ").concat(a,"px; \n            top: ").concat(s,"px; \n            width: ").concat(i,"px; \n            z-index: ").concat(this.render.getSettings().startZIndex+1,";")}},{key:"getElement",value:function(){return this.element}},{key:"load",value:function(){this.isLoad=!0}},{key:"setOrientation",value:function(t){n(a(i.prototype),"setOrientation",this).call(this,t),this.element.classList.remove("--left","--right"),this.element.classList.add(1===t?"--right":"--left")}},{key:"setDrawingDensity",value:function(t){this.element.classList.remove("--soft","--hard"),this.element.classList.add("--"+t),n(a(i.prototype),"setDrawingDensity",this).call(this,t)}}]),i}(e),p=function(t){r(i,t);var e=o(i);function i(t,n,a,s){var r;return h(this,i),(r=e.call(this,t,n)).element=a,r.pagesElement=s,r}return l(i,[{key:"load",value:function(){var t,e=s(this.pagesElement);try{for(e.s();!(t=e.n()).done;){var i=t.value,n=new d(this.render,i,"hard"===i.dataset.density?"hard":"soft");n.load(),this.pages.push(n)}}catch(a){e.e(a)}finally{e.f()}this.createSpread()}}]),i}(c),f=function(){function t(e,i,n,a){h(this,t),this.direction=e,this.corner=i,this.topIntersectPoint=null,this.sideIntersectPoint=null,this.bottomIntersectPoint=null,this.pageWidth=parseInt(n,10),this.pageHeight=parseInt(a,10)}return l(t,[{key:"calc",value:function(t){try{return this.position=this.calcAngleAndPosition(t),this.calculateIntersectPoint(this.position),!0}catch(t){return!1}}},{key:"getFlippingClipArea",value:function(){var t=[],e=!1;return t.push(this.rect.topLeft),t.push(this.topIntersectPoint),null===this.sideIntersectPoint?e=!0:(t.push(this.sideIntersectPoint),null===this.bottomIntersectPoint&&(e=!1)),t.push(this.bottomIntersectPoint),(e||"bottom"===this.corner)&&t.push(this.rect.bottomLeft),t}},{key:"getBottomClipArea",value:function(){var t=[];return t.push(this.topIntersectPoint),"top"===this.corner?t.push({x:this.pageWidth,y:0}):(null!==this.topIntersectPoint&&t.push({x:this.pageWidth,y:0}),t.push({x:this.pageWidth,y:this.pageHeight})),null!==this.sideIntersectPoint?u.GetDistanceBetweenTwoPoint(this.sideIntersectPoint,this.topIntersectPoint)>=10&&t.push(this.sideIntersectPoint):"top"===this.corner&&t.push({x:this.pageWidth,y:this.pageHeight}),t.push(this.bottomIntersectPoint),t.push(this.topIntersectPoint),t}},{key:"getAngle",value:function(){return 0===this.direction?-this.angle:this.angle}},{key:"getRect",value:function(){return this.rect}},{key:"getPosition",value:function(){return this.position}},{key:"getActiveCorner",value:function(){return 0===this.direction?this.rect.topLeft:this.rect.topRight}},{key:"getDirection",value:function(){return this.direction}},{key:"getFlippingProgress",value:function(){return Math.abs((this.position.x-this.pageWidth)/(2*this.pageWidth)*100)}},{key:"getCorner",value:function(){return this.corner}},{key:"getBottomPagePosition",value:function(){return 1===this.direction?{x:this.pageWidth,y:0}:{x:0,y:0}}},{key:"getShadowStartPoint",value:function(){return"top"===this.corner?this.topIntersectPoint:null!==this.sideIntersectPoint?this.sideIntersectPoint:this.topIntersectPoint}},{key:"getShadowAngle",value:function(){var t=u.GetAngleBetweenTwoLine(this.getSegmentToShadowLine(),[{x:0,y:0},{x:this.pageWidth,y:0}]);return 0===this.direction?t:Math.PI-t}},{key:"calcAngleAndPosition",value:function(t){var e=t;if(this.updateAngleAndGeometry(e),e="top"===this.corner?this.checkPositionAtCenterLine(e,{x:0,y:0},{x:0,y:this.pageHeight}):this.checkPositionAtCenterLine(e,{x:0,y:this.pageHeight},{x:0,y:0}),Math.abs(e.x-this.pageWidth)<1&&Math.abs(e.y)<1)throw new Error("Point is too small");return e}},{key:"updateAngleAndGeometry",value:function(t){this.angle=this.calculateAngle(t),this.rect=this.getPageRect(t)}},{key:"calculateAngle",value:function(t){var e=this.pageWidth-t.x+1,i="bottom"===this.corner?this.pageHeight-t.y:t.y,n=2*Math.acos(e/Math.sqrt(i*i+e*e));i<0&&(n=-n);var a=Math.PI-n;if(!isFinite(n)||a>=0&&a<.003)throw new Error("The G point is too small");return"bottom"===this.corner&&(n=-n),n}},{key:"getPageRect",value:function(t){return"top"===this.corner?this.getRectFromBasePoint([{x:0,y:0},{x:this.pageWidth,y:0},{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}],t):this.getRectFromBasePoint([{x:0,y:-this.pageHeight},{x:this.pageWidth,y:-this.pageHeight},{x:0,y:0},{x:this.pageWidth,y:0}],t)}},{key:"getRectFromBasePoint",value:function(t,e){return{topLeft:this.getRotatedPoint(t[0],e),topRight:this.getRotatedPoint(t[1],e),bottomLeft:this.getRotatedPoint(t[2],e),bottomRight:this.getRotatedPoint(t[3],e)}}},{key:"getRotatedPoint",value:function(t,e){return{x:t.x*Math.cos(this.angle)+t.y*Math.sin(this.angle)+e.x,y:t.y*Math.cos(this.angle)-t.x*Math.sin(this.angle)+e.y}}},{key:"calculateIntersectPoint",value:function(t){var e={left:-1,top:-1,width:this.pageWidth+2,height:this.pageHeight+2};"top"===this.corner?(this.topIntersectPoint=u.GetIntersectBetweenTwoSegment(e,[t,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=u.GetIntersectBetweenTwoSegment(e,[t,this.rect.bottomLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=u.GetIntersectBetweenTwoSegment(e,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}])):(this.topIntersectPoint=u.GetIntersectBetweenTwoSegment(e,[this.rect.topLeft,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=u.GetIntersectBetweenTwoSegment(e,[t,this.rect.topLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=u.GetIntersectBetweenTwoSegment(e,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}]))}},{key:"checkPositionAtCenterLine",value:function(t,e,i){var n=t,a=u.LimitPointToCircle(e,this.pageWidth,n);n!==a&&(n=a,this.updateAngleAndGeometry(n));var s=Math.sqrt(Math.pow(this.pageWidth,2)+Math.pow(this.pageHeight,2)),r=this.rect.bottomRight,o=this.rect.topLeft;if("bottom"===this.corner&&(r=this.rect.topRight,o=this.rect.bottomLeft),r.x<=0){var h=u.LimitPointToCircle(i,s,o);h!==n&&(n=h,this.updateAngleAndGeometry(n))}return n}},{key:"getSegmentToShadowLine",value:function(){var t=this.getShadowStartPoint();return[t,t!==this.sideIntersectPoint&&null!==this.sideIntersectPoint?this.sideIntersectPoint:this.bottomIntersectPoint]}}]),t}(),y=function(){function t(e,i){h(this,t),this.flippingPage=null,this.bottomPage=null,this.calc=null,this.state="read",this.render=e,this.app=i}return l(t,[{key:"fold",value:function(t){this.setState("user_fold"),null===this.calc&&this.start(t),this.do(this.render.convertToPage(t))}},{key:"flip",value:function(t){if((!this.app.getSettings().disableFlipByClick||this.isPointOnCorners(t))&&(null!==this.calc&&this.render.finishAnimation(),this.start(t))){var e=this.getBoundsRect();this.setState("flipping");var i=e.height/10,n="bottom"===this.calc.getCorner()?e.height-i:i,a="bottom"===this.calc.getCorner()?e.height:0;this.calc.calc({x:e.pageWidth-i,y:n}),this.animateFlippingTo({x:e.pageWidth-i,y:n},{x:-e.pageWidth,y:a},!0)}}},{key:"start",value:function(t){this.reset();var e=this.render.convertToBook(t),i=this.getBoundsRect(),n=this.getDirectionByPoint(e),a=e.y>=i.height/2?"bottom":"top";if(!this.checkDirection(n))return!1;try{if(this.flippingPage=this.app.getPageCollection().getFlippingPage(n),this.bottomPage=this.app.getPageCollection().getBottomPage(n),"landscape"===this.render.getOrientation())if(1===n){var s=this.app.getPageCollection().nextBy(this.flippingPage);null!==s&&this.flippingPage.getDensity()!==s.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),s.setDrawingDensity("hard"))}else{var r=this.app.getPageCollection().prevBy(this.flippingPage);null!==r&&this.flippingPage.getDensity()!==r.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),r.setDrawingDensity("hard"))}return this.render.setDirection(n),this.calc=new f(n,a,i.pageWidth.toString(10),i.height.toString(10)),!0}catch(t){return!1}}},{key:"do",value:function(t){if(null!==this.calc&&this.calc.calc(t)){var e=this.calc.getFlippingProgress();this.bottomPage.setArea(this.calc.getBottomClipArea()),this.bottomPage.setPosition(this.calc.getBottomPagePosition()),this.bottomPage.setAngle(0),this.bottomPage.setHardAngle(0),this.flippingPage.setArea(this.calc.getFlippingClipArea()),this.flippingPage.setPosition(this.calc.getActiveCorner()),this.flippingPage.setAngle(this.calc.getAngle()),0===this.calc.getDirection()?this.flippingPage.setHardAngle(90*(200-2*e)/100):this.flippingPage.setHardAngle(-90*(200-2*e)/100),this.render.setPageRect(this.calc.getRect()),this.render.setBottomPage(this.bottomPage),this.render.setFlippingPage(this.flippingPage),this.render.setShadowData(this.calc.getShadowStartPoint(),this.calc.getShadowAngle(),e,this.calc.getDirection())}}},{key:"flipToPage",value:function(t,e){var i=this.app.getPageCollection().getCurrentSpreadIndex(),n=this.app.getPageCollection().getSpreadIndexByPage(t);try{n>i&&(this.app.getPageCollection().setCurrentSpreadIndex(n-1),this.flipNext(e)),n<i&&(this.app.getPageCollection().setCurrentSpreadIndex(n+1),this.flipPrev(e))}catch(t){}}},{key:"flipNext",value:function(t){this.flip({x:this.render.getRect().left+2*this.render.getRect().pageWidth-10,y:"top"===t?1:this.render.getRect().height-2})}},{key:"flipPrev",value:function(t){this.flip({x:10,y:"top"===t?1:this.render.getRect().height-2})}},{key:"stopMove",value:function(){if(null!==this.calc){var t=this.calc.getPosition(),e=this.getBoundsRect(),i="bottom"===this.calc.getCorner()?e.height:0;t.x<=0?this.animateFlippingTo(t,{x:-e.pageWidth,y:i},!0):this.animateFlippingTo(t,{x:e.pageWidth,y:i},!1)}}},{key:"showCorner",value:function(t){if(this.checkState("read","fold_corner")){var e=this.getBoundsRect(),i=e.pageWidth;if(this.isPointOnCorners(t))if(null===this.calc){if(!this.start(t))return;this.setState("fold_corner"),this.calc.calc({x:i-1,y:1});var n=50,a="bottom"===this.calc.getCorner()?e.height-1:1,s="bottom"===this.calc.getCorner()?e.height-n:n;this.animateFlippingTo({x:i-1,y:a},{x:i-n,y:s},!1,!1)}else this.do(this.render.convertToPage(t));else this.setState("read"),this.render.finishAnimation(),this.stopMove()}}},{key:"animateFlippingTo",value:function(t,e,i){var n,a=this,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=u.GetCordsFromTwoPoint(t,e),h=[],l=s(o);try{var c=function(){var t=n.value;h.push((function(){return a.do(t)}))};for(l.s();!(n=l.n()).done;)c()}catch(d){l.e(d)}finally{l.f()}var g=this.getAnimationDuration(o.length);this.render.startAnimation(h,g,(function(){a.calc&&(i&&(1===a.calc.getDirection()?a.app.turnToPrevPage():a.app.turnToNextPage()),r&&(a.render.setBottomPage(null),a.render.setFlippingPage(null),a.render.clearShadow(),a.setState("read"),a.reset()))}))}},{key:"getCalculation",value:function(){return this.calc}},{key:"getState",value:function(){return this.state}},{key:"setState",value:function(t){this.state!==t&&(this.app.updateState(t),this.state=t)}},{key:"getDirectionByPoint",value:function(t){var e=this.getBoundsRect();if("portrait"===this.render.getOrientation()){if(t.x-e.pageWidth<=e.width/5)return 1}else if(t.x<e.width/2)return 1;return 0}},{key:"getAnimationDuration",value:function(t){var e=this.app.getSettings().flippingTime;return t>=1e3?e:t/1e3*e}},{key:"checkDirection",value:function(t){return 0===t?this.app.getCurrentPageIndex()<this.app.getPageCount()-1:this.app.getCurrentPageIndex()>=1}},{key:"reset",value:function(){this.calc=null,this.flippingPage=null,this.bottomPage=null}},{key:"getBoundsRect",value:function(){return this.render.getRect()}},{key:"checkState",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];for(var n=0,a=e;n<a.length;n++){var s=a[n];if(this.state===s)return!0}return!1}},{key:"isPointOnCorners",value:function(t){var e=this.getBoundsRect(),i=e.pageWidth,n=Math.sqrt(Math.pow(i,2)+Math.pow(e.height,2))/5,a=this.render.convertToBook(t);return a.x>0&&a.y>0&&a.x<e.width&&a.y<e.height&&(a.x<n||a.x>e.width-n)&&(a.y<n||a.y>e.height-n)}}]),t}(),v=function(){function t(e,i){h(this,t),this.leftPage=null,this.rightPage=null,this.flippingPage=null,this.bottomPage=null,this.direction=null,this.orientation=null,this.shadow=null,this.animation=null,this.pageRect=null,this.boundsRect=null,this.timer=0,this.safari=!1,this.setting=i,this.app=e;var n=new RegExp("Version\\/[\\d\\.]+.*Safari/");this.safari=null!==n.exec(window.navigator.userAgent)}return l(t,[{key:"render",value:function(t){if(null!==this.animation){var e=Math.round((t-this.animation.startedAt)/this.animation.durationFrame);e<this.animation.frames.length?this.animation.frames[e]():(this.animation.onAnimateEnd(),this.animation=null)}this.timer=t,this.drawFrame()}},{key:"start",value:function(){var t=this;this.update();var e=function e(i){t.render(i),requestAnimationFrame(e)};requestAnimationFrame(e)}},{key:"startAnimation",value:function(t,e,i){this.finishAnimation(),this.animation={frames:t,duration:e,durationFrame:e/t.length,onAnimateEnd:i,startedAt:this.timer}}},{key:"finishAnimation",value:function(){null!==this.animation&&(this.animation.frames[this.animation.frames.length-1](),null!==this.animation.onAnimateEnd&&this.animation.onAnimateEnd()),this.animation=null}},{key:"update",value:function(){this.boundsRect=null;var t=this.calculateBoundsRect();this.orientation!==t&&(this.orientation=t,this.app.updateOrientation(t))}},{key:"calculateBoundsRect",value:function(){var t="landscape",e=this.getBlockWidth(),i=e/2,n=this.getBlockHeight()/2,a=this.setting.width/this.setting.height,s=this.setting.width,r=this.setting.height,o=i-s;return"stretch"===this.setting.size?(e<2*this.setting.minWidth&&this.app.getSettings().usePortrait&&(t="portrait"),(s="portrait"===t?this.getBlockWidth():this.getBlockWidth()/2)>this.setting.maxWidth&&(s=this.setting.maxWidth),(r=s/a)>this.getBlockHeight()&&(s=(r=this.getBlockHeight())*a),o="portrait"===t?i-s/2-s:i-s):e<2*s&&this.app.getSettings().usePortrait&&(t="portrait",o=i-s/2-s),this.boundsRect={left:o,top:n-r/2,width:2*s,height:r,pageWidth:s},t}},{key:"setShadowData",value:function(t,e,i,n){if(this.app.getSettings().drawShadow){var a=100*this.getSettings().maxShadowOpacity;this.shadow={pos:t,angle:e,width:3*this.getRect().pageWidth/4*i/100,opacity:(100-i)*a/100/100,direction:n,progress:2*i}}}},{key:"clearShadow",value:function(){this.shadow=null}},{key:"getBlockWidth",value:function(){return this.app.getUI().getDistElement().offsetWidth}},{key:"getBlockHeight",value:function(){return this.app.getUI().getDistElement().offsetHeight}},{key:"getDirection",value:function(){return this.direction}},{key:"getRect",value:function(){return null===this.boundsRect&&this.calculateBoundsRect(),this.boundsRect}},{key:"getSettings",value:function(){return this.app.getSettings()}},{key:"getOrientation",value:function(){return this.orientation}},{key:"setPageRect",value:function(t){this.pageRect=t}},{key:"setDirection",value:function(t){this.direction=t}},{key:"setRightPage",value:function(t){null!==t&&t.setOrientation(1),this.rightPage=t}},{key:"setLeftPage",value:function(t){null!==t&&t.setOrientation(0),this.leftPage=t}},{key:"setBottomPage",value:function(t){null!==t&&t.setOrientation(1===this.direction?0:1),this.bottomPage=t}},{key:"setFlippingPage",value:function(t){null!==t&&t.setOrientation(0===this.direction&&"portrait"!==this.orientation?0:1),this.flippingPage=t}},{key:"convertToBook",value:function(t){var e=this.getRect();return{x:t.x-e.left,y:t.y-e.top}}},{key:"isSafari",value:function(){return this.safari}},{key:"convertToPage",value:function(t,e){e||(e=this.direction);var i=this.getRect();return{x:0===e?t.x-i.left-i.width/2:i.width/2-t.x+i.left,y:t.y-i.top}}},{key:"convertToGlobal",value:function(t,e){if(e||(e=this.direction),null==t)return null;var i=this.getRect();return{x:0===e?t.x+i.left+i.width/2:i.width/2-t.x+i.left,y:t.y+i.top}}},{key:"convertRectToGlobal",value:function(t,e){return e||(e=this.direction),{topLeft:this.convertToGlobal(t.topLeft,e),topRight:this.convertToGlobal(t.topRight,e),bottomLeft:this.convertToGlobal(t.bottomLeft,e),bottomRight:this.convertToGlobal(t.bottomRight,e)}}}]),t}(),w=function(t){r(i,t);var e=o(i);function i(t,n,a){var s;return h(this,i),(s=e.call(this,t,n)).canvas=a,s.ctx=a.getContext("2d"),s}return l(i,[{key:"getContext",value:function(){return this.ctx}},{key:"reload",value:function(){}},{key:"drawFrame",value:function(){this.clear(),"portrait"!==this.orientation&&null!=this.leftPage&&this.leftPage.simpleDraw(0),null!=this.rightPage&&this.rightPage.simpleDraw(1),null!=this.bottomPage&&this.bottomPage.draw(),this.drawBookShadow(),null!=this.flippingPage&&this.flippingPage.draw(),null!=this.shadow&&(this.drawOuterShadow(),this.drawInnerShadow());var t=this.getRect();"portrait"===this.orientation&&(this.ctx.beginPath(),this.ctx.rect(t.left+t.pageWidth,t.top,t.width,t.height),this.ctx.clip())}},{key:"drawBookShadow",value:function(){var t=this.getRect();this.ctx.save(),this.ctx.beginPath();var e=t.width/20;this.ctx.rect(t.left,t.top,t.width,t.height);var i={x:t.left+t.width/2-e/2,y:0};this.ctx.translate(i.x,i.y);var n=this.ctx.createLinearGradient(0,0,e,0);n.addColorStop(0,"rgba(0, 0, 0, 0)"),n.addColorStop(.4,"rgba(0, 0, 0, 0.2)"),n.addColorStop(.49,"rgba(0, 0, 0, 0.1)"),n.addColorStop(.5,"rgba(0, 0, 0, 0.5)"),n.addColorStop(.51,"rgba(0, 0, 0, 0.4)"),n.addColorStop(1,"rgba(0, 0, 0, 0)"),this.ctx.clip(),this.ctx.fillStyle=n,this.ctx.fillRect(0,0,e,2*t.height),this.ctx.restore()}},{key:"drawOuterShadow",value:function(){var t=this.getRect();this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(t.left,t.top,t.width,t.height);var e=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y});this.ctx.translate(e.x,e.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);var i=this.ctx.createLinearGradient(0,0,this.shadow.width,0);0===this.shadow.direction?(this.ctx.translate(0,-100),i.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),i.addColorStop(1,"rgba(0, 0, 0, 0)")):(this.ctx.translate(-this.shadow.width,-100),i.addColorStop(0,"rgba(0, 0, 0, 0)"),i.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")")),this.ctx.clip(),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,this.shadow.width,2*t.height),this.ctx.restore()}},{key:"drawInnerShadow",value:function(){var t=this.getRect();this.ctx.save(),this.ctx.beginPath();var e=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),i=this.convertRectToGlobal(this.pageRect);this.ctx.moveTo(i.topLeft.x,i.topLeft.y),this.ctx.lineTo(i.topRight.x,i.topRight.y),this.ctx.lineTo(i.bottomRight.x,i.bottomRight.y),this.ctx.lineTo(i.bottomLeft.x,i.bottomLeft.y),this.ctx.translate(e.x,e.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);var n=3*this.shadow.width/4,a=this.ctx.createLinearGradient(0,0,n,0);0===this.shadow.direction?(this.ctx.translate(-n,-100),a.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")"),a.addColorStop(.9,"rgba(0, 0, 0, 0.05)"),a.addColorStop(.7,"rgba(0, 0, 0, "+this.shadow.opacity+")"),a.addColorStop(0,"rgba(0, 0, 0, 0)")):(this.ctx.translate(0,-100),a.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),a.addColorStop(.1,"rgba(0, 0, 0, 0.05)"),a.addColorStop(.3,"rgba(0, 0, 0, "+this.shadow.opacity+")"),a.addColorStop(1,"rgba(0, 0, 0, 0)")),this.ctx.clip(),this.ctx.fillStyle=a,this.ctx.fillRect(0,0,n,2*t.height),this.ctx.restore()}},{key:"clear",value:function(){this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}}]),i}(v),m=function(){function t(e,i,n){var a=this;h(this,t),this.touchPoint=null,this.swipeTimeout=250,this.onResize=function(){a.update()},this.onMouseDown=function(t){if(a.checkTarget(t.target)){var e=a.getMousePos(t.clientX,t.clientY);a.app.startUserTouch(e),t.preventDefault()}},this.onTouchStart=function(t){if(a.checkTarget(t.target)&&t.changedTouches.length>0){var e=t.changedTouches[0],i=a.getMousePos(e.clientX,e.clientY);a.touchPoint={point:i,time:Date.now()},setTimeout((function(){null!==a.touchPoint&&a.app.startUserTouch(i)}),a.swipeTimeout),a.app.getSettings().mobileScrollSupport||t.preventDefault()}},this.onMouseUp=function(t){var e=a.getMousePos(t.clientX,t.clientY);a.app.userStop(e)},this.onMouseMove=function(t){var e=a.getMousePos(t.clientX,t.clientY);a.app.userMove(e,!1)},this.onTouchMove=function(t){if(t.changedTouches.length>0){var e=t.changedTouches[0],i=a.getMousePos(e.clientX,e.clientY);a.app.getSettings().mobileScrollSupport?(null!==a.touchPoint&&(Math.abs(a.touchPoint.point.x-i.x)>10||"read"!==a.app.getState())&&t.cancelable&&a.app.userMove(i,!0),"read"!==a.app.getState()&&t.preventDefault()):a.app.userMove(i,!0)}},this.onTouchEnd=function(t){if(t.changedTouches.length>0){var e=t.changedTouches[0],i=a.getMousePos(e.clientX,e.clientY),n=!1;if(null!==a.touchPoint){var s=i.x-a.touchPoint.point.x,r=Math.abs(i.y-a.touchPoint.point.y);Math.abs(s)>a.swipeDistance&&r<2*a.swipeDistance&&Date.now()-a.touchPoint.time<a.swipeTimeout&&(s>0?a.app.flipPrev(a.touchPoint.point.y<a.app.getRender().getRect().height/2?"top":"bottom"):a.app.flipNext(a.touchPoint.point.y<a.app.getRender().getRect().height/2?"top":"bottom"),n=!0),a.touchPoint=null}a.app.userStop(i,n)}},this.parentElement=e,e.classList.add("stf__parent"),e.insertAdjacentHTML("afterbegin",'<div class="stf__wrapper"></div>'),this.wrapper=e.querySelector(".stf__wrapper"),this.app=i;var s=this.app.getSettings().usePortrait?1:2;e.style.minWidth=n.minWidth*s+"px",e.style.minHeight=n.minHeight+"px","fixed"===n.size&&(e.style.minWidth=n.width*s+"px",e.style.minHeight=n.height+"px"),n.autoSize&&(e.style.width="100%",e.style.maxWidth=2*n.maxWidth+"px"),e.style.display="block",window.addEventListener("resize",this.onResize,!1),this.swipeDistance=n.swipeDistance}return l(t,[{key:"destroy",value:function(){this.app.getSettings().useMouseEvents&&this.removeHandlers(),this.distElement.remove(),this.wrapper.remove()}},{key:"getDistElement",value:function(){return this.distElement}},{key:"getWrapper",value:function(){return this.wrapper}},{key:"setOrientationStyle",value:function(t){this.wrapper.classList.remove("--portrait","--landscape"),"portrait"===t?(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/this.app.getSettings().width*100+"%"),this.wrapper.classList.add("--portrait")):(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/(2*this.app.getSettings().width)*100+"%"),this.wrapper.classList.add("--landscape")),this.update()}},{key:"removeHandlers",value:function(){window.removeEventListener("resize",this.onResize),this.distElement.removeEventListener("mousedown",this.onMouseDown),this.distElement.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchend",this.onTouchEnd)}},{key:"setHandlers",value:function(){window.addEventListener("resize",this.onResize,!1),this.app.getSettings().useMouseEvents&&(this.distElement.addEventListener("mousedown",this.onMouseDown),this.distElement.addEventListener("touchstart",this.onTouchStart),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!this.app.getSettings().mobileScrollSupport}),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchend",this.onTouchEnd))}},{key:"getMousePos",value:function(t,e){var i=this.distElement.getBoundingClientRect();return{x:t-i.left,y:e-i.top}}},{key:"checkTarget",value:function(t){return!this.app.getSettings().clickEventForward||!["a","button"].includes(t.tagName.toLowerCase())}}]),t}(),x=function(t){r(i,t);var e=o(i);function i(t,n,a,r){var o;h(this,i),(o=e.call(this,t,n,a)).wrapper.insertAdjacentHTML("afterbegin",'<div class="stf__block"></div>'),o.distElement=t.querySelector(".stf__block"),o.items=r;var l,c=s(r);try{for(c.s();!(l=c.n()).done;){var g=l.value;o.distElement.appendChild(g)}}catch(u){c.e(u)}finally{c.f()}return o.setHandlers(),o}return l(i,[{key:"clear",value:function(){var t,e=s(this.items);try{for(e.s();!(t=e.n()).done;){var i=t.value;this.parentElement.appendChild(i)}}catch(n){e.e(n)}finally{e.f()}}},{key:"updateItems",value:function(t){this.removeHandlers(),this.distElement.innerHTML="";var e,i=s(t);try{for(i.s();!(e=i.n()).done;){var n=e.value;this.distElement.appendChild(n)}}catch(a){i.e(a)}finally{i.f()}this.items=t,this.setHandlers()}},{key:"update",value:function(){this.app.getRender().update()}}]),i}(m),P=function(t){r(i,t);var e=o(i);function i(t,n,a){var s;return h(this,i),(s=e.call(this,t,n,a)).wrapper.innerHTML='<canvas class="stf__canvas"></canvas>',s.canvas=t.querySelectorAll("canvas")[0],s.distElement=s.canvas,s.resizeCanvas(),s.setHandlers(),s}return l(i,[{key:"resizeCanvas",value:function(){var t=getComputedStyle(this.canvas),e=parseInt(t.getPropertyValue("width"),10),i=parseInt(t.getPropertyValue("height"),10);this.canvas.width=e,this.canvas.height=i}},{key:"getCanvas",value:function(){return this.canvas}},{key:"update",value:function(){this.resizeCanvas(),this.app.getRender().update()}}]),i}(m),k=function(t){r(i,t);var e=o(i);function i(t,n,a){var s;return h(this,i),(s=e.call(this,t,n)).outerShadow=null,s.innerShadow=null,s.hardShadow=null,s.hardInnerShadow=null,s.element=a,s.createShadows(),s}return l(i,[{key:"createShadows",value:function(){this.element.insertAdjacentHTML("beforeend",'<div class="stf__outerShadow"></div>\n             <div class="stf__innerShadow"></div>\n             <div class="stf__hardShadow"></div>\n             <div class="stf__hardInnerShadow"></div>'),this.outerShadow=this.element.querySelector(".stf__outerShadow"),this.innerShadow=this.element.querySelector(".stf__innerShadow"),this.hardShadow=this.element.querySelector(".stf__hardShadow"),this.hardInnerShadow=this.element.querySelector(".stf__hardInnerShadow")}},{key:"clearShadow",value:function(){n(a(i.prototype),"clearShadow",this).call(this),this.outerShadow.style.cssText="display: none",this.innerShadow.style.cssText="display: none",this.hardShadow.style.cssText="display: none",this.hardInnerShadow.style.cssText="display: none"}},{key:"reload",value:function(){this.element.querySelector(".stf__outerShadow")||this.createShadows()}},{key:"drawHardInnerShadow",value:function(){var t=this.getRect(),e=this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress,i=(100-e)*(2.5*t.pageWidth)/100+20;i>t.pageWidth&&(i=t.pageWidth);var n="\n            display: block;\n            z-index: ".concat((this.getSettings().startZIndex+5).toString(10),";\n            width: ").concat(i,"px;\n            height: ").concat(t.height,"px;\n            background: linear-gradient(to right,\n                rgba(0, 0, 0, ").concat(this.shadow.opacity*e/100,") 5%,\n                rgba(0, 0, 0, 0) 100%);\n            left: ").concat(t.left+t.width/2,"px;\n            transform-origin: 0 0;\n        ");n+=0===this.getDirection()&&this.shadow.progress>100||1===this.getDirection()&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0);":"transform: translate3d(0, 0, 0) rotateY(180deg);",this.hardInnerShadow.style.cssText=n}},{key:"drawHardOuterShadow",value:function(){var t=this.getRect(),e=(100-(this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress))*(2.5*t.pageWidth)/100+20;e>t.pageWidth&&(e=t.pageWidth);var i="\n            display: block;\n            z-index: ".concat((this.getSettings().startZIndex+4).toString(10),";\n            width: ").concat(e,"px;\n            height: ").concat(t.height,"px;\n            background: linear-gradient(to left, rgba(0, 0, 0, ").concat(this.shadow.opacity,") 5%, rgba(0, 0, 0, 0) 100%);\n            left: ").concat(t.left+t.width/2,"px;\n            transform-origin: 0 0;\n        ");i+=0===this.getDirection()&&this.shadow.progress>100||1===this.getDirection()&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0) rotateY(180deg);":"transform: translate3d(0, 0, 0);",this.hardShadow.style.cssText=i}},{key:"drawInnerShadow",value:function(){for(var t=this.getRect(),e=3*this.shadow.width/4,i=0===this.getDirection()?e:0,n=0===this.getDirection()?"to left":"to right",a=this.convertToGlobal(this.shadow.pos),s=this.shadow.angle+3*Math.PI/2,r="polygon( ",o=0,h=[this.pageRect.topLeft,this.pageRect.topRight,this.pageRect.bottomRight,this.pageRect.bottomLeft];o<h.length;o++){var l=h[o],c=1===this.getDirection()?{x:-l.x+this.shadow.pos.x,y:l.y-this.shadow.pos.y}:{x:l.x-this.shadow.pos.x,y:l.y-this.shadow.pos.y};r+=(c=u.GetRotatedPoint(c,{x:i,y:100},s)).x+"px "+c.y+"px, "}r=r.slice(0,-2),r+=")";var g="\n            display: block;\n            z-index: ".concat((this.getSettings().startZIndex+10).toString(10),";\n            width: ").concat(e,"px;\n            height: ").concat(2*t.height,"px;\n            background: linear-gradient(").concat(n,",\n                rgba(0, 0, 0, ").concat(this.shadow.opacity,") 5%,\n                rgba(0, 0, 0, 0.05) 15%,\n                rgba(0, 0, 0, ").concat(this.shadow.opacity,") 35%,\n                rgba(0, 0, 0, 0) 100%);\n            transform-origin: ").concat(i,"px 100px;\n            transform: translate3d(").concat(a.x-i,"px, ").concat(a.y-100,"px, 0) rotate(").concat(s,"rad);\n            clip-path: ").concat(r,";\n            -webkit-clip-path: ").concat(r,";\n        ");this.innerShadow.style.cssText=g}},{key:"drawOuterShadow",value:function(){for(var t=this.getRect(),e=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),i=this.shadow.angle+3*Math.PI/2,n=1===this.getDirection()?this.shadow.width:0,a=0===this.getDirection()?"to right":"to left",s="polygon( ",r=0,o=[{x:0,y:0},{x:t.pageWidth,y:0},{x:t.pageWidth,y:t.height},{x:0,y:t.height}];r<o.length;r++){var h=o[r];if(null!==h){var l=1===this.getDirection()?{x:-h.x+this.shadow.pos.x,y:h.y-this.shadow.pos.y}:{x:h.x-this.shadow.pos.x,y:h.y-this.shadow.pos.y};s+=(l=u.GetRotatedPoint(l,{x:n,y:100},i)).x+"px "+l.y+"px, "}}s=s.slice(0,-2),s+=")";var c="\n            display: block;\n            z-index: ".concat((this.getSettings().startZIndex+10).toString(10),";\n            width: ").concat(this.shadow.width,"px;\n            height: ").concat(2*t.height,"px;\n            background: linear-gradient(").concat(a,", rgba(0, 0, 0, ").concat(this.shadow.opacity,"), rgba(0, 0, 0, 0));\n            transform-origin: ").concat(n,"px 100px;\n            transform: translate3d(").concat(e.x-n,"px, ").concat(e.y-100,"px, 0) rotate(").concat(i,"rad);\n            clip-path: ").concat(s,";\n            -webkit-clip-path: ").concat(s,";\n        ");this.outerShadow.style.cssText=c}},{key:"drawLeftPage",value:function(){"portrait"!==this.orientation&&null!==this.leftPage&&(1===this.direction&&null!==this.flippingPage&&"hard"===this.flippingPage.getDrawingDensity()?(this.leftPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.leftPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.leftPage.draw(this.flippingPage.getDrawingDensity())):this.leftPage.simpleDraw(0))}},{key:"drawRightPage",value:function(){null!==this.rightPage&&(0===this.direction&&null!==this.flippingPage&&"hard"===this.flippingPage.getDrawingDensity()?(this.rightPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.rightPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.rightPage.draw(this.flippingPage.getDrawingDensity())):this.rightPage.simpleDraw(1))}},{key:"drawBottomPage",value:function(){if(null!==this.bottomPage){var t=null!=this.flippingPage?this.flippingPage.getDrawingDensity():null;"portrait"===this.orientation&&1===this.direction||(this.bottomPage.getElement().style.zIndex=(this.getSettings().startZIndex+3).toString(10),this.bottomPage.draw(t))}}},{key:"drawFrame",value:function(){this.clear(),this.drawLeftPage(),this.drawRightPage(),this.drawBottomPage(),null!=this.flippingPage&&(this.flippingPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.flippingPage.draw()),null!=this.shadow&&null!==this.flippingPage&&("soft"===this.flippingPage.getDrawingDensity()?(this.drawOuterShadow(),this.drawInnerShadow()):(this.drawHardOuterShadow(),this.drawHardInnerShadow()))}},{key:"clear",value:function(){var t,e=s(this.app.getPageCollection().getPages());try{for(e.s();!(t=e.n()).done;){var i=t.value;i!==this.leftPage&&i!==this.rightPage&&i!==this.flippingPage&&i!==this.bottomPage&&(i.getElement().style.cssText="display: none"),i.getTemporaryCopy()!==this.flippingPage&&i.hideTemporaryCopy()}}catch(n){e.e(n)}finally{e.f()}}},{key:"update",value:function(){n(a(i.prototype),"update",this).call(this),null!==this.rightPage&&this.rightPage.setOrientation(1),null!==this.leftPage&&this.leftPage.setOrientation(0)}}]),i}(v),S=function(){function t(){h(this,t),this._default={startPage:0,size:"fixed",width:0,height:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,drawShadow:!0,flippingTime:1e3,usePortrait:!0,startZIndex:0,autoSize:!0,maxShadowOpacity:1,showCover:!1,mobileScrollSupport:!0,swipeDistance:30,clickEventForward:!0,useMouseEvents:!0,showPageCorners:!0,disableFlipByClick:!1}}return l(t,[{key:"getSettings",value:function(t){var e=this._default;if(Object.assign(e,t),"stretch"!==e.size&&"fixed"!==e.size)throw new Error('Invalid size type. Available only "fixed" and "stretch" value');if(e.width<=0||e.height<=0)throw new Error("Invalid width or height");if(e.flippingTime<=0)throw new Error("Invalid flipping time");return"stretch"===e.size?(e.minWidth<=0&&(e.minWidth=100),e.maxWidth<e.minWidth&&(e.maxWidth=2e3),e.minHeight<=0&&(e.minHeight=100),e.maxHeight<e.minHeight&&(e.maxHeight=2e3)):(e.minWidth=e.width,e.maxWidth=e.width,e.minHeight=e.height,e.maxHeight=e.height),e}}]),t}();!function(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===i&&n.firstChild?n.insertBefore(a,n.firstChild):n.appendChild(a),a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t))}}(".stf__parent {\n  position: relative;\n  display: block;\n  box-sizing: border-box;\n  transform: translateZ(0);\n\n  -ms-touch-action: pan-y;\n  touch-action: pan-y;\n}\n\n.sft__wrapper {\n  position: relative;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.stf__parent canvas {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  left: 0;\n  top: 0;\n}\n\n.stf__block {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  box-sizing: border-box;\n  perspective: 2000px;\n}\n\n.stf__item {\n  display: none;\n  position: absolute;\n  transform-style: preserve-3d;\n}\n\n.stf__outerShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.stf__innerShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.stf__hardShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.stf__hardInnerShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}"),t.PageFlip=function(t){r(i,t);var e=o(i);function i(t,n){var a;return h(this,i),(a=e.call(this)).isUserTouch=!1,a.isUserMove=!1,a.setting=null,a.pages=null,a.setting=(new S).getSettings(n),a.block=t,a}return l(i,[{key:"destroy",value:function(){this.ui.destroy(),this.block.remove()}},{key:"update",value:function(){this.render.update(),this.pages.show()}},{key:"loadFromImages",value:function(t){var e=this;this.ui=new P(this.block,this,this.setting);var i=this.ui.getCanvas();this.render=new w(this,this.setting,i),this.flipController=new y(this.render,this),this.pages=new g(this,this.render,t),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout((function(){e.ui.update(),e.trigger("init",e,{page:e.setting.startPage,mode:e.render.getOrientation()})}),1)}},{key:"loadFromHTML",value:function(t){var e=this;this.ui=new x(this.block,this,this.setting,t),this.render=new k(this,this.setting,this.ui.getDistElement()),this.flipController=new y(this.render,this),this.pages=new p(this,this.render,this.ui.getDistElement(),t),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout((function(){e.ui.update(),e.trigger("init",e,{page:e.setting.startPage,mode:e.render.getOrientation()})}),1)}},{key:"updateFromImages",value:function(t){var e=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new g(this,this.render,t),this.pages.load(),this.pages.show(e),this.trigger("update",this,{page:e,mode:this.render.getOrientation()})}},{key:"updateFromHtml",value:function(t){var e=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new p(this,this.render,this.ui.getDistElement(),t),this.pages.load(),this.ui.updateItems(t),this.render.reload(),this.pages.show(e),this.trigger("update",this,{page:e,mode:this.render.getOrientation()})}},{key:"clear",value:function(){this.pages.destroy(),this.ui.clear()}},{key:"turnToPrevPage",value:function(){this.pages.showPrev()}},{key:"turnToNextPage",value:function(){this.pages.showNext()}},{key:"turnToPage",value:function(t){this.pages.show(t)}},{key:"flipNext",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";this.flipController.flipNext(t)}},{key:"flipPrev",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";this.flipController.flipPrev(t)}},{key:"flip",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"top";this.flipController.flipToPage(t,e)}},{key:"updateState",value:function(t){this.trigger("changeState",this,t)}},{key:"updatePageIndex",value:function(t){this.trigger("flip",this,t)}},{key:"updateOrientation",value:function(t){this.ui.setOrientationStyle(t),this.update(),this.trigger("changeOrientation",this,t)}},{key:"getPageCount",value:function(){return this.pages.getPageCount()}},{key:"getCurrentPageIndex",value:function(){return this.pages.getCurrentPageIndex()}},{key:"getPage",value:function(t){return this.pages.getPage(t)}},{key:"getRender",value:function(){return this.render}},{key:"getFlipController",value:function(){return this.flipController}},{key:"getOrientation",value:function(){return this.render.getOrientation()}},{key:"getBoundsRect",value:function(){return this.render.getRect()}},{key:"getSettings",value:function(){return this.setting}},{key:"getUI",value:function(){return this.ui}},{key:"getState",value:function(){return this.flipController.getState()}},{key:"getPageCollection",value:function(){return this.pages}},{key:"startUserTouch",value:function(t){this.mousePosition=t,this.isUserTouch=!0,this.isUserMove=!1}},{key:"userMove",value:function(t,e){this.isUserTouch||e||!this.setting.showPageCorners?this.isUserTouch&&u.GetDistanceBetweenTwoPoint(this.mousePosition,t)>5&&(this.isUserMove=!0,this.flipController.fold(t)):this.flipController.showCorner(t)}},{key:"userStop",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isUserTouch&&(this.isUserTouch=!1,e||(this.isUserMove?this.flipController.stopMove():this.flipController.flip(t)))}}]),i}(function(){function t(){h(this,t),this.events=new Map}return l(t,[{key:"on",value:function(t,e){return this.events.has(t)?this.events.get(t).push(e):this.events.set(t,[e]),this}},{key:"off",value:function(t){this.events.delete(t)}},{key:"trigger",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.events.has(t)){var n,a=s(this.events.get(t));try{for(a.s();!(n=a.n()).done;)(0,n.value)({data:i,object:e})}catch(r){a.e(r)}finally{a.f()}}}}]),t}()),Object.defineProperty(t,"__esModule",{value:!0})}(e)}}]);
//# sourceMappingURL=12.99716ae9.chunk.js.map